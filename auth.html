

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Authentication &mdash; mattermostdriver 7.3.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mattermostdriver
          

          
          </a>

          
            
            
              <div class="version">
                7.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="endpoints.html">Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">CONTRIBUTING</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mattermostdriver</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Authentication</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/auth.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="authentication">
<h1>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h1>
<p>Yuu can either use the normal ways for login, by token and or username,
or authenticate using the .netrc file. This passes the credentials to the
requests library, where you can also read more about that.</p>
<p>A nice example for authentication with .netrc by <a class="reference external" href="https://github.com/apfeiffer1">&#64;apfeiffer</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># A simple example to retrieve all users for a team while using a _token_ </span>
<span class="c1"># from the .netrc file instead of a password (as requests assumes by default)</span>

<span class="kn">import</span> <span class="nn">logging</span> 
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">netrc</span>

<span class="kn">from</span> <span class="nn">mattermostdriver</span> <span class="kn">import</span> <span class="n">Driver</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span> <span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span> <span class="s1">&#39;MattermostManager&#39;</span> <span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span> <span class="p">)</span>

<span class="c1"># requests overrides the simple authentication token header if it finds the entry in </span>
<span class="c1"># the ~/.netrc file. Since we want to use ~/.netrc to retrieve the _token_, we need</span>
<span class="c1"># to provide our own Authenticator class:</span>

<span class="k">class</span> <span class="nc">TokenAuth</span><span class="p">(</span> <span class="n">requests</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">AuthBase</span> <span class="p">)</span> <span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">r</span> <span class="p">)</span> <span class="p">:</span>
        <span class="c1"># Implement my authentication</span>
        <span class="n">mmHost</span> <span class="o">=</span> <span class="s1">&#39;mattermost.host.in.netrc&#39;</span>
        <span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">()</span><span class="o">.</span><span class="n">authenticators</span><span class="p">(</span> <span class="n">mmHost</span> <span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span> <span class="s1">&#39;Authorization&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bearer </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">password</span>
        <span class="k">return</span> <span class="n">r</span>


<span class="k">class</span> <span class="nc">MattermostManager</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span> <span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">:</span>

        <span class="c1"># Get the _token_ (as &quot;password&quot;) from the ~/.netrc file.</span>
        <span class="c1"># the corresponding line in the file should look like:</span>
        <span class="c1"># &lt;mattermost.host.in.netrc&gt; foo foo &lt;long-string-of-token&gt;</span>
        <span class="c1"># The &quot;login&quot; and &quot;account&quot; (both set to &quot;foo&quot; in the example are ignored)</span>
        
        <span class="n">mmHost</span> <span class="o">=</span> <span class="s1">&#39;mattermost.host.in.netrc&#39;</span>
        <span class="p">(</span><span class="n">login</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="o">=</span> <span class="n">netrc</span><span class="o">.</span><span class="n">netrc</span><span class="p">()</span><span class="o">.</span><span class="n">authenticators</span><span class="p">(</span> <span class="n">mmHost</span> <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s2">&quot;Going to set up driver for connection to </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mmHost</span><span class="p">,)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span> <span class="o">=</span> <span class="n">Driver</span><span class="p">(</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;url&#39;</span>    <span class="p">:</span> <span class="n">mmHost</span><span class="p">,</span>
            <span class="s1">&#39;scheme&#39;</span> <span class="p">:</span> <span class="s1">&#39;https&#39;</span><span class="p">,</span>
            <span class="s1">&#39;port&#39;</span>   <span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
            <span class="s1">&#39;auth&#39;</span>   <span class="p">:</span> <span class="n">TokenAuth</span><span class="p">,</span> <span class="c1"># use the new Authenticator class defined above</span>
        <span class="p">}</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span> <span class="n">user_id</span><span class="o">=</span><span class="s1">&#39;me&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">getTeamMembers</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">teamName</span> <span class="p">)</span> <span class="p">:</span>

        <span class="c1"># for restricted teams, we need to get the ID first, and</span>
        <span class="c1"># for this, we need to have the &quot;name&quot; (as in the URL), not</span>
        <span class="c1"># the &quot;display name&quot;, as shown in the GUIs:</span>

        <span class="n">team0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span><span class="o">.</span><span class="n">teams</span><span class="o">.</span><span class="n">get_team_by_name</span><span class="p">(</span> <span class="n">teamName</span> <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;team by name </span><span class="si">%s</span><span class="s1"> : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">teamName</span><span class="p">,</span> <span class="n">team0</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">teamId</span> <span class="o">=</span> <span class="n">team0</span><span class="p">[</span> <span class="s1">&#39;id&#39;</span> <span class="p">]</span>

        <span class="n">team</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span><span class="o">.</span><span class="n">teams</span><span class="o">.</span><span class="n">check_team_exists</span><span class="p">(</span> <span class="n">teamName</span> <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;team </span><span class="si">%s</span><span class="s1"> - exists: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">teamName</span><span class="p">,</span> <span class="n">team</span><span class="p">[</span> <span class="s1">&#39;exists&#39;</span> <span class="p">])</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">team</span><span class="p">[</span> <span class="s1">&#39;exists&#39;</span> <span class="p">]</span> <span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="s1">&#39;no team with name </span><span class="si">%s</span><span class="s1"> found&#39;</span> <span class="o">%</span> <span class="n">teamName</span> <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;found team </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">teamName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span><span class="o">.</span><span class="n">teams</span><span class="o">.</span><span class="n">get_team</span><span class="p">(</span> <span class="n">teamId</span> <span class="p">))</span> <span class="p">)</span>

        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getAllUsersForTeam</span><span class="p">(</span> <span class="n">teamId</span> <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;found </span><span class="si">%s</span><span class="s1"> users for team &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">users</span> <span class="p">),</span> <span class="n">teamName</span><span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">users</span>

    <span class="k">def</span> <span class="nf">_getAllUsersForTeam</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">teamId</span> <span class="p">)</span> <span class="p">:</span>

        <span class="c1"># get all users for a team</span>
        <span class="c1"># with the max of 200 per page, we need to iterate a bit over the pages</span>

        <span class="n">users</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
        <span class="n">pgNo</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">teamUsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;in_team&#39;</span>  <span class="p">:</span> <span class="n">teamId</span><span class="p">,</span>
                                                            <span class="s1">&#39;page&#39;</span>     <span class="p">:</span> <span class="nb">str</span><span class="p">(</span> <span class="n">pgNo</span> <span class="p">),</span>
                                                            <span class="s1">&#39;per_page&#39;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                                                            <span class="p">}</span> <span class="p">)</span>
        <span class="k">while</span> <span class="n">teamUsers</span> <span class="p">:</span>
            <span class="n">users</span> <span class="o">+=</span> <span class="n">teamUsers</span>
            <span class="n">pgNo</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">teamUsers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mmDriver</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;in_team&#39;</span>  <span class="p">:</span> <span class="n">teamId</span><span class="p">,</span>
                                                                <span class="s1">&#39;per_page&#39;</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
                                                                <span class="s1">&#39;page&#39;</span>     <span class="p">:</span> <span class="nb">str</span><span class="p">(</span> <span class="n">pgNo</span> <span class="p">),</span>
                                                                <span class="p">}</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">users</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span> <span class="p">:</span>
    <span class="n">mmM</span> <span class="o">=</span> <span class="n">MattermostManager</span><span class="p">()</span>
    <span class="n">mmM</span><span class="o">.</span><span class="n">getTeamMembers</span><span class="p">(</span> <span class="s1">&#39;myTeam&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Christian Plümer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'7.3.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>